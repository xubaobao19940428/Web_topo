(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["a203da30"],{"0a20":function(t,e,n){},"251e":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"topo-fullscreen"},[n("TopoRender")],1)},i=[],a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.configData.layer?n("div",{staticClass:"topo-render",style:t.layerStyle},[t._l(t.configData.components,(function(e,o){return[n("div",{directives:[{name:"show",rawName:"v-show",value:void 0==e.style.visible||e.style.visible,expression:"component.style.visible == undefined? true:component.style.visible"}],key:o,staticClass:"topo-render-wrapper",class:{"topo-render-wrapper-clickable":e.action.length>0},style:{left:e.style.position.x+"px",top:e.style.position.y+"px",width:e.style.position.w+"px",height:e.style.position.h+"px",backgroundColor:e.style.backColor,zIndex:e.style.zIndex,borderWidth:e.style.borderWidth+"px",borderStyle:e.style.borderStyle,borderColor:e.style.borderColor,transform:e.style.transform?"rotate("+e.style.transform+"deg)":"rotate(0deg)"},on:{click:function(n){return t.doClickComponent(e,o)},dblclick:function(n){return t.doDbClickComponent(e)}}},[n(t.parseView(e),{ref:"spirit",refInFor:!0,tag:"component",attrs:{detail:e}}),t._l(e.action,(function(e,o){return n("span",{key:o},["image"==e.action||"video"==e.action||"audio"==e.action?n("form",{ref:"uploadform",refInFor:!0,attrs:{method:"POST",enctype:"multipart/form-data"}},[n("input",{staticStyle:{position:"relative",top:"-40px",opacity:"0","z-index":"5",height:"50px",width:"100px"},attrs:{type:"file"},on:{change:function(e){return t.upload(e)}}})]):t._e()])}))],2)]})),n("div",{staticClass:"q-pa-lg flex flex-center"},[n("q-pagination",{attrs:{max:t.maxtotal,"direction-links":!0},on:{input:t.setPagesize},model:{value:t.current,callback:function(e){t.current=e},expression:"current"}})],1)],2):t._e()},s=[],r=(n("4917"),n("7514"),n("34ef"),n("28a5"),n("7f7f"),n("6e0e")),c=n("bc3a"),l=n.n(c),p=n("3693"),d=n("bf48"),u=n.n(d),f=n("7ded"),h=n("a78e"),m=n.n(h),g=n("5118");n("8149");var v={name:"TopoRender",extends:r["a"],components:{},computed:{layerStyle:function(){var t=[];this.configData.layer.backColor&&t.push("background-color: ".concat(this.configData.layer.backColor)),this.configData.layer.backgroundImage&&t.push('background-image: url("'.concat(this.configData.layer.backgroundImage,'")')),this.configData.layer.width>0&&t.push("width: ".concat(this.configData.layer.width,"px")),this.configData.layer.height>0&&t.push("height: ".concat(this.configData.layer.height,"px"));var e=t.join(";");return e}},data:function(){return{configData:{},type:"",title:"",contents:"",blob:"",component:[],componentindex:"",devaddr:"",productid:"",nodeType:"",standard:"",testbed:"",taskid:"",application:"",current:1,maxtotal:0,ispump:!1}},methods:{parseView:function(t){return p["a"].parseViewName(t)},doClickComponent:function(t,e){this.component=t,this.componentindex=e,console.log(t,e);for(var n=0;n<t.action.length;n++){var o=t.action[n];"click"==o.type&&this.handleComponentActuib(o)}},doDbClickComponent:function(t){for(var e=0;e<t.action.length;e++){var n=t.action[e];"dblclick"==n.type&&this.handleComponentActuib(n)}},upload:function(t){if(t){var e=t.target.files[0],n=e.name,o=e.type.split("/")[0];if(console.log(o),o===this.component.action[0].action){var i=new FileReader;i.readAsDataURL(e);var a=this;i.onloadend=function(){var t=i.result;console.log(i);var e=a.dataURItoBlob(t);a.uploadFile(e,n)}}else"image"===this.component.action[0].action?this.$q.notify({color:"purple",position:"top",message:"请上传图片文件"}):"video"===this.component.action[0].action?this.$q.notify({color:"purple",position:"top",message:"请上传视频文件"}):"audio"===this.component.action[0].action&&this.$q.notify({color:"purple",position:"top",message:"请上传音频文件"})}},dataURItoBlob:function(t){for(var e=atob(t.split(",")[1]),n=t.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(e.length),i=new Uint8Array(o),a=0;a<e.length;a++)i[a]=e.charCodeAt(a);return new Blob([o],{type:n})},uploadFile:function(t,e){var n=this,o=new FormData;o.append("file",t,e),o.append("output","json"),o.append("path",u.a.User.current().id),o.append("auth_token",m.a.get("sessionToken"));var i={headers:{"Content-Type":"multipart/form-data"}};l.a.post("http://file.iotn2n.com/shapes/upload",o,i).then((function(t){if(200==t.status){t.data.url,t.data.md5;if(n.component.action[0].action="link",n.component.action[0].showItems=t.data.url,n.$set(n.configData.components,n.index,n.component),-1==n.ispump){var e=u.a.Object.extend("Product"),o=new e;o.id=n.productid,o.set("config",n.configData),o.save().then((function(t){t&&alert("保存成功")}))}else{var i=u.a.Object.extend("Devices"),a=new i;a.id=n.productid,a.set("basedata",n.configData),a.save().then((function(t){t&&n.$q.notify({color:"positive",position:"top",message:"保存成功"})}))}}}))},handleComponentUrl:function(t){window.open(t.showItems)},handleComponentAlert:function(t){window.alert(t.showItems)},handleComponentActuib:function(t){var e=this;"visible"==t.action?(t.showItems.length>0&&t.showItems.forEach((function(t){e.showComponent(t,!0)})),t.hideItems.length>0&&t.hideItems.forEach((function(t){e.showComponent(t,!1)}))):"service"==t.action?e.sendFun(t):"link"==t.action?e.handleComponentUrl(t):"alert"==t.action?e.handleComponentAlert(t):"image"==t.action?e.upload():"video"==t.action?e.upload():"audio"==t.action?e.upload():"last"==t.action||t.action},showComponent:function(t,e){console.log("show:"+t+",visible:"+e);for(var n=this.$refs["spirit"],o=0;o<n.length;o++){var i=n[o];if(i.detail.identifier==t){i.detail.style.visible=e;break}}},getReportDevices:function(){var t=this,e=u.a.Object.extend("Devices"),n=new u.a.Query(e);n.get(this.productid).then((function(e){t.configData=e.attributes.basedata;var n=u.a.Object.extend("Devices"),o=new u.a.Query(n);o.equalTo("brand",t.taskid),o.count().then((function(e){t.maxtotal=e}))}))},getProductView:function(){var t=this,e=u.a.Object.extend("Product"),n=new u.a.Query(e);n.get(this.productid).then((function(e){t.configData=e.attributes.config,Object(f["a"])(t.devaddr,t.productid,m.a.get("sessionToken")).then((function(e){t.configData.components.map((function(t){e.data.map((function(e){t.wumoxing.identifier==e.identifier&&(t.wumoxing.value=e.value)}))}))}))}))},setIntervalDetail:function(){var t=this;Object(g["setInterval"])((function(){Object(f["a"])(t.devaddr,t.productid).then((function(e){t.configData.components.map((function(t){e.data.map((function(e){t.wumoxing.identifier==e.identifier&&(t.wumoxing.value=e.value)}))}))}))}),5e3)},getparam:function(){for(var t=location.hash.substring(12),e=t.split("&"),n=new Array(e.length),o=0;o<e.length;o++){var i=e[o].indexOf("=");if(-1!=i){e[o].substring(0,i);n[o]=e[o].substring(i+1)}}-1==this.ispump?(this.devaddr=n[0],this.productid=n[1],this.getProductView()):(this.standard=n[0],this.taskid=n[1],this.productid=n[2],this.testbed=n[3],this.getReportDevices())},setPagesize:function(t){var e=this,n=u.a.Object.extend("Devices"),o=new u.a.Query(n);o.equalTo("brand",this.taskid),o.equalTo("basedata.index",t),o.find().then((function(t){e.configData=t[0].attributes.basedata,e.productid=t[0].id}))}},mounted:function(){var t=this;if(this.application=m.a.get("application"),this.ispump=this.application.match("pump"),console.log(this.ispump),this.nodeType=localStorage.getItem("nodeType"),localStorage.getItem("topoData")){var e=localStorage.getItem("topoData");this.configData=JSON.parse(e)}else 1==this.nodeType&&-1==this.ispump?setTimeout((function(){t.getparam()}),1e3):0==this.nodeType&&-1==this.ispump?setTimeout((function(){t.getparam(),t.setIntervalDetail()}),1e3):-1!=this.ispump&&this.getparam()},beforeDestroy:function(){localStorage.removeItem("topoData")}},b=v,y=(n("ad78"),n("2877")),w=Object(y["a"])(b,a,s,!1,null,null,null),x=w.exports,D={name:"TopoFullscreen",components:{TopoRender:x},methods:{},created:function(){},mounted:function(){}},k=D,C=(n("2e7b"),Object(y["a"])(k,o,i,!1,null,null,null));e["default"]=C.exports},"2e7b":function(t,e,n){"use strict";var o=n("0a20"),i=n.n(o);i.a},7807:function(t,e,n){},ad78:function(t,e,n){"use strict";var o=n("7807"),i=n.n(o);i.a}}]);